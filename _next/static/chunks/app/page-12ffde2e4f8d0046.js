(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7055:function(e,t,n){Promise.resolve().then(n.bind(n,887))},257:function(e,t,n){"use strict";var i,r;e.exports=(null==(i=n.g.process)?void 0:i.env)&&"object"==typeof(null==(r=n.g.process)?void 0:r.env)?n.g.process:n(4227)},4227:function(e){!function(){var t={229:function(e){var t,n,i,r=e.exports={};function l(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===l||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:l}catch(e){t=l}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var s=[],d=!1,c=-1;function u(){d&&i&&(d=!1,i.length?s=i.concat(s):c=-1,s.length&&h())}function h(){if(!d){var e=a(u);d=!0;for(var t=s.length;t;){for(i=s,s=[];++c<t;)i&&i[c].run();c=-1,t=s.length}i=null,d=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];s.push(new g(e,t)),1!==s.length||d||a(h)},g.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw Error("process.chdir is not supported")},r.umask=function(){return 0}}},n={};function i(e){var r=n[e];if(void 0!==r)return r.exports;var l=n[e]={exports:{}},o=!0;try{t[e](l,l.exports,i),o=!1}finally{o&&delete n[e]}return l.exports}i.ab="//";var r=i(229);e.exports=r}()},887:function(e,t,n){"use strict";n.d(t,{default:function(){return f}});var i=n(7437),r=n(2265),l=n(257);let o=l.env.NEXT_PUBLIC_BASE_PATH||"";l.env.NEXT_PUBLIC_REPO_NAME;let a=e=>{let t=e.startsWith("/")?e.slice(1):e;return"".concat(o,"/").concat(t)},s=e=>e.startsWith("http://")||e.startsWith("https://")||e.startsWith("//"),d=e=>s(e)?e:a(e);var c=e=>{let{image:t,imageMetadata:n,boundingBoxes:l,onAddBoundingBox:o,onUpdateBoundingBox:a,onDeleteBoundingBox:s,isDrawing:c,setIsDrawing:u}=e,h=(0,r.useRef)(null),[g,m]=(0,r.useState)(null),[x,f]=(0,r.useState)(null),p=(0,r.useCallback)(e=>{if(!n)return{x:0,y:0,width:0,height:0};let{displaySize:t,originalSize:i}=n,r=t.width/i.width,l=t.height/i.height;return{x:e.x*r,y:e.y*l,width:e.width*r,height:e.height*l}},[n]),b=(0,r.useCallback)(e=>{if(!n)return{x:0,y:0,width:0,height:0};let{displaySize:t,originalSize:i}=n,r=i.width/t.width,l=i.height/t.height;return{x:e.x*r,y:e.y*l,width:e.width*r,height:e.height*l}},[n]),y=(e,t)=>{if(e.stopPropagation(),m(t),!c){let n=l.find(e=>e.id===t);n&&f({type:"move",boxId:t,startX:e.clientX,startY:e.clientY,originalBox:n})}},w=(e,t,n)=>{e.stopPropagation(),m(t);let i=l.find(e=>e.id===t);i&&f({type:"resize",boxId:t,handle:n,startX:e.clientX,startY:e.clientY,originalBox:i})};return((0,r.useEffect)(()=>{let e=e=>{"Delete"===e.key&&g&&(s(g),m(null))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[g,s]),t)?(0,i.jsxs)("div",{ref:h,className:"relative border border-gray-300 rounded-lg overflow-hidden bg-white",style:{width:null==n?void 0:n.displaySize.width,height:null==n?void 0:n.displaySize.height,cursor:c?"crosshair":"default"},onMouseDown:e=>{if(!h.current)return;let t=h.current.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top;c&&f({type:"draw",startX:n,startY:i,originalBox:{x:n,y:i,width:0,height:0,label:"new-box"}})},onMouseMove:e=>{if(!x||!h.current)return;let t=h.current.getBoundingClientRect();if(e.clientX,t.left,e.clientY,t.top,"draw"===x.type&&x.originalBox){let{startX:e,startY:t}=x;({...x.originalBox})}else if("move"===x.type&&x.originalBox){let t=e.clientX-x.startX,n=e.clientY-x.startY,i=b({x:t,y:n,width:0,height:0}).x,r=b({x:t,y:n,width:0,height:0}).y;a(x.boxId,{x:x.originalBox.x+i,y:x.originalBox.y+r})}else if("resize"===x.type&&x.originalBox){let t=e.clientX-x.startX,n=e.clientY-x.startY,{handle:i,originalBox:r}=x,{x:l,y:o,width:s,height:d}=p(r);i&&(i.includes("right")&&(s+=t),i.includes("left")&&(l+=t,s-=t),i.includes("bottom")&&(d+=n),i.includes("top")&&(o+=n,d-=n));let c=b({x:l,y:o,width:s,height:d});a(x.boxId,c)}},onMouseUp:e=>{if(x&&"draw"===x.type&&x.originalBox){let t=h.current.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top,{startX:r,startY:l}=x,a=b({x:Math.min(r,n),y:Math.min(l,i),width:Math.abs(n-r),height:Math.abs(i-l)});a.width>5&&a.height>5&&o({...a,label:"new-box"})}f(null),u(!1)},children:[(0,i.jsx)("img",{src:t,alt:"Annotation target",className:"max-w-full h-auto",style:{width:null==n?void 0:n.displaySize.width,height:null==n?void 0:n.displaySize.height},onError:e=>{console.error("Failed to load image:",t),e.currentTarget.src=d("placeholder-error.png")}}),l.map(e=>{let t=p(e),n=g===e.id;return(0,i.jsxs)("div",{className:"absolute transition-colors duration-150 ease-in-out\n              ".concat(n?"border-blue-500 ring-2 ring-blue-300":"border-yellow-400 hover:bg-yellow-400/20","\n              border-2"),style:{left:t.x,top:t.y,width:t.width,height:t.height,cursor:"move"},onMouseDown:t=>y(t,e.id),onClick:t=>{t.stopPropagation(),m(e.id)},children:[(0,i.jsx)("div",{className:"absolute -top-7 left-0 text-xs font-semibold px-1.5 py-0.5 rounded-sm\n              ".concat(n?"bg-blue-500 text-white":"bg-yellow-400 text-black"),children:e.label}),n&&[{position:"top-left",cursor:"nwse-resize"},{position:"top-right",cursor:"nesw-resize"},{position:"bottom-left",cursor:"nesw-resize"},{position:"bottom-right",cursor:"nwse-resize"}].map(t=>{let{position:n,cursor:r}=t;return(0,i.jsx)("div",{className:"absolute w-4 h-4 -m-2 rounded-full bg-blue-500 border-2 border-white",style:{cursor:r,top:n.includes("top")?0:void 0,bottom:n.includes("bottom")?0:void 0,left:n.includes("left")?0:void 0,right:n.includes("right")?0:void 0},onMouseDown:t=>w(t,e.id,n)},n)})]},e.id)})]}):(0,i.jsx)("div",{className:"flex items-center justify-center h-96 bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("p",{className:"text-gray-500 text-lg",children:"No image loaded"}),(0,i.jsx)("p",{className:"text-gray-400 text-sm mt-2",children:"Load an image to start annotating"})]})})},u=e=>{let{onImageLoad:t,onSubmit:n,onClear:l,onDraw:o,boundingBoxCount:a,hasImage:s}=e,[d,c]=(0,r.useState)(""),u=(0,r.useRef)(null);return(0,i.jsxs)("div",{className:"space-y-4 p-4 bg-white rounded-lg shadow",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Controls"}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Image URL"}),(0,i.jsxs)("form",{onSubmit:e=>{e.preventDefault(),d.trim()&&t(d.trim())},className:"flex gap-2",children:[(0,i.jsx)("input",{type:"url",value:d,onChange:e=>c(e.target.value),placeholder:"https://example.com/image.jpg",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,i.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Load"})]})]}),(0,i.jsx)("div",{className:"text-center text-gray-500",children:"or"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload File"}),(0,i.jsx)("input",{ref:u,type:"file",accept:"image/*",onChange:e=>{var n;let i=null===(n=e.target.files)||void 0===n?void 0:n[0];if(i){let e=new FileReader;e.onload=e=>{var n;t(null===(n=e.target)||void 0===n?void 0:n.result)},e.readAsDataURL(i)}},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})]}),(0,i.jsx)("div",{className:"text-center text-gray-500",children:"or"}),(0,i.jsx)("button",{onClick:()=>{t("sample-images/sample1.jpg")},className:"w-full px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Load Sample Image"}),(0,i.jsx)("div",{className:"text-center text-gray-500",children:"or"}),(0,i.jsx)("button",{onClick:()=>{fetch("https://api.waifu.im/search").then(e=>e.json()).then(e=>{t(e.images[0].url)})},className:"w-full px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500",children:"Fetch Random Image"})]}),(0,i.jsx)("div",{className:"border-t border-gray-200 my-4"}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("button",{onClick:o,disabled:!s,className:"w-full bg-cyan-500 text-white p-2 rounded disabled:bg-gray-300",children:"Draw Box"}),(0,i.jsx)("button",{onClick:n,disabled:!s||0===a,className:"w-full bg-green-500 text-white p-2 rounded disabled:bg-gray-300",children:"Submit Annotation"}),(0,i.jsx)("button",{onClick:l,disabled:!s||0===a,className:"w-full bg-red-500 text-white p-2 rounded disabled:bg-gray-300",children:"Clear Annotations"})]}),(0,i.jsxs)("p",{className:"text-sm text-gray-600",children:["Bounding Boxes: ",a]})]})},h=()=>(0,i.jsxs)("div",{className:"p-4 bg-white rounded-lg shadow",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold",children:"Export"}),(0,i.jsx)("button",{className:"w-full bg-gray-700 text-white p-2 rounded mt-2",children:"Export All Data"})]});let g=e=>{let t=m(),n=t.annotation_records.findIndex(t=>t.image_url===e.image_url);-1!==n?t.annotation_records[n]=e:t.annotation_records.push(e),t.total_images=t.annotation_records.length,t.total_annotations=t.annotation_records.reduce((e,t)=>e+t.bounding_boxes.length,0),t.last_updated=new Date().toISOString(),localStorage.setItem("annotation_data",JSON.stringify(t))},m=()=>{let e=localStorage.getItem("annotation_data");return e?JSON.parse(e):{annotation_records:[],total_images:0,total_annotations:0,last_updated:new Date().toISOString()}},x=()=>{let[e,t]=(0,r.useState)(null),[n,i]=(0,r.useState)(null),[l,o]=(0,r.useState)([]),[a,s]=(0,r.useState)(null),c=(0,r.useCallback)(e=>{i(e);let n=d(e);t(n),o([]);let r=new Image;r.onload=()=>{let e=Math.min(800/r.naturalWidth,600/r.naturalHeight,1);s({originalSize:{width:r.naturalWidth,height:r.naturalHeight},displaySize:{width:r.naturalWidth*e,height:r.naturalHeight*e},scaleFactor:e})},r.onerror=()=>{alert("Failed to load image. Please check the URL or try a different image."),t(null),i(null)},r.src=n},[]),u=(0,r.useCallback)(()=>{n&&a&&(g({session_id:"session_".concat(Date.now()),image_url:n,original_size:a.originalSize,display_size:a.displaySize,scale_factor:a.scaleFactor,annotator:"anonymous",timestamp:new Date().toISOString(),bounding_boxes:l}),o([]),t(null),i(null),alert("Annotation submitted successfully!"))},[n,a,l]),h=(0,r.useCallback)(e=>{let t={...e,id:"box_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))};o(e=>[...e,t])},[]);return{currentImage:e,boundingBoxes:l,imageMetadata:a,loadImage:c,addBoundingBox:h,updateBoundingBox:(0,r.useCallback)((e,t)=>{o(n=>n.map(n=>n.id===e?{...n,...t}:n))},[]),deleteBoundingBox:(0,r.useCallback)(e=>{o(t=>t.filter(t=>t.id!==e))},[]),submitAnnotation:u,clearAnnotations:(0,r.useCallback)(()=>{o([])},[])}};var f=()=>{let{currentImage:e,boundingBoxes:t,imageMetadata:n,loadImage:l,addBoundingBox:o,updateBoundingBox:a,deleteBoundingBox:s,submitAnnotation:d,clearAnnotations:g}=x(),[m,f]=(0,r.useState)(!1),p=(0,r.useCallback)(e=>{l(e)},[l]),b=(0,r.useCallback)(()=>{if(0===t.length){alert("Please create at least one bounding box before submitting!");return}d()},[t,d]);return(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 p-4",children:(0,i.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,i.jsxs)("header",{className:"mb-8",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Image Annotation System"}),(0,i.jsx)("p",{className:"text-gray-600",children:"Create bounding boxes for machine learning training data"})]}),(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,i.jsx)("div",{className:"lg:col-span-3",children:(0,i.jsx)(c,{image:e,imageMetadata:n,boundingBoxes:t,onAddBoundingBox:o,onUpdateBoundingBox:a,onDeleteBoundingBox:s,isDrawing:m,setIsDrawing:f})}),(0,i.jsxs)("div",{className:"lg:col-span-1 space-y-6",children:[(0,i.jsx)(u,{onImageLoad:p,onSubmit:b,onClear:g,onDraw:()=>{f(!0)},boundingBoxCount:t.length,hasImage:!!e}),(0,i.jsx)(h,{})]})]})]})})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=7055)}),_N_E=e.O()}]);